pipeline {
    agent any

    environment {
        TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0ZW5hbnQiOiJiNmNhZGQwNS1lMzQxLTNmMTctYjU1Zi00OTM0MTI4MWQ4MmEiLCJhY2NvdW50SWQiOiI1ZWU0ZjM3YjFmYjJjYTBhYzU0OTNhMjMiLCJpc1hlYSI6ZmFsc2UsImlhdCI6MTc3MDgwNDgxMCwiZXhwIjoxNzcwODkxMjEwLCJhdWQiOiI5M0IzN0ZCNjQ3ODI0QjA5QTZGRDBDNTk4MTU2MjVDQyIsImlzcyI6ImNvbS54cGFuZGl0LnBsdWdpbnMueHJheSIsInN1YiI6IjkzQjM3RkI2NDc4MjRCMDlBNkZEMEM1OTgxNTYyNUNDIn0.x9xElkwNax_Uc4Q2nZTdkeivgz_6cWBWWBKY-SIAEmw"
    }

    stages {
        stage('Build & Test') {
             steps {
                echo 'Ex√©cution des tests Robot Framework...'
                bat 'robot -d results testCases/'
             }
        }
    }

    post {
        always {
            echo "Import vers Xray..."
            bat  'curl -H "Content-Type: text/xml" -X POST -H "Authorization: Bearer %TOKEN%"  --data @"results/output.xml" https://xray.cloud.getxray.app/api/v2/import/execution/robot?projectKey=POEI2'
        }
        success { echo 'Pipeline termin√© avec succ√®s üéâ' }
        failure { echo '√âchec du pipeline ‚ùå' }
    }
}